<!DOCTYPE html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>Chemistry Project</title>
  <meta name="description" content="template" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-orbit-controls@1.0.0/dist/aframe-orbit-controls.min.js"></script>
  <script src="https://unpkg.com/aframe-supercraft-loader@1.1.3/dist/aframe-supercraft-loader.js"></script>
  <script type="text/javascript" src="color-map.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <link rel="manifest" href="site.webmanifest" />
  <link rel="apple-touch-icon" href="icon.png" />
  <link rel="stylesheet" href="css/main-flex.css" />


  <!-- <script src="https://unpkg.com/hammer-touchemulator@0.0.2/touch-emulator.js"></script>
  <script>TouchEmulator();</script> -->
</head>

<body>

  <header>Header</header>
  <div class="container">
    <div class="left-box">
      <div class="top-ctl">
        <a-scene embedded vr-mode-ui="enabled: false" background="color: #ECECEC" outline="enabled: false; width: 5 5; range: 0 10; strength: 10; smooth: true;">
          <a-cylinder id="cylinder" color="crimson" height="1" radius="1" theta-start="50" rotation="45"
            cursor-listener></a-cylinder>

          <a-entity camera look-controls orbit-controls="target: 0 0 0; minDistance: 0.5; maxDistance: 180; initialPosition: 0 0 3"></a-entity>
          <a-entity cursor="rayOrigin: mouse"></a-entity>
        </a-scene>
      </div>
      <div class="bottom-ctl"></div>
    </div>
    <div class="content" id="my-stain-glass">
      <!-- <svg id="mysvg" width="500" height="300">
        <rect x="10" y="20" width="90" height="60" class="color-selector" data-color="rgb(255,0,0)" metal="Au" medium="glass"
          style="fill:rgb(255,0,0);">

        </rect>
        <rect x="10" y="120" width="90" height="60" class="color-selector" data-color="rgb(0,255,0)" metal="Au" medium="glass"
          style="fill:rgb(0,255,0);">

        </rect>
        <rect x="10" y="220" width="90" height="60" class="color-selector" data-color="rgb(0,0,255)" metal="Au" medium="glass"
          style="fill:rgb(0,0,255);">


        </rect>
        Sorry, your browser does not support inline SVG.
      </svg> -->

      <!-- <object id="svg" data="rec.svg" type="image/svg+xml"></object> -->

    </div>
  </div>

  <div class="bar-ctl">
    <div class="rod-length">
      <label for="item">Length:</label>
      <!-- <input type="range" name="number" id="number1" min="1" max="56" /> -->
      <input class="mdl-slider mdl-js-slider" id="number1" type="range" min="1" max="56" value="28" >
    </div>
    <div class="rod-radius">
      <label for="item">Radius:</label>
      <!-- <input type="range" name="number" id="number2" min="1" max="16" /> -->
      <input class="mdl-slider mdl-js-slider" id="number2" type="range" min="1" max="16" value="8" >
    </div>

    <div class="metal-comp">
      <label for="item">Metal:</label><br />
      <input type="radio" name="metal" id="metal1" value="Au"  checked />Gold
      <input type="radio" name="metal" id="metal2" value="Ag" /> Silver
      <!-- <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="item-1">
        <input type="radio" id="metal1" class="mdl-radio__button" name="options" value="Au" checked>
        <span class="mdl-radio__label">Gold</span>
      </label>
      <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="item-2">
        <input type="radio" id="metal2" class="mdl-radio__button" name="options" value="Ag">
        <span class="mdl-radio__label">Silver</span>
      </label> -->
    </div>
    <div class="medium-comp">
      <label for="item">Medium:</label><br />
      <input type="radio" name="medium" id="medium1" value="glass" class="mdl-radio__button" checked />Glass
      <input type="radio" name="medium" id="medium2" value="water" class="mdl-radio__button"/> Water
    </div>
  </div>

  <footer>
      <button id="history-but" type="button" class="mdl-button show-modal">History of Stained Glass</button>
      <dialog class="mdl-dialog" id="history-dia">
        <h1 class="mdl-dialog__title" >History of Stained Glass</h1>
        <!-- <div class="mdl-dialog__content">
          <p>
            Allowing us to collect data will let us get you the information you want faster.
          </p>
        </div>
        <div class="mdl-dialog__actions">
          <button type="button" class="mdl-button">Agree</button>
          <button type="button" class="mdl-button close">Disagree</button>
        </div> -->
      </dialog>

      <button id="science-but" type="button" class="mdl-button">Science of Stained Glass</button>
      <dialog class="mdl-dialog" id="science-dia">
        <h2 class="mdl-dialog__title" >Science of Stained Glass</h2>
        <!-- <div class="mdl-dialog__content">
          <p>
            Allowing us to collect data will let us get you the information you want faster.
          </p>
        </div>
        <div class="mdl-dialog__actions">
          <button type="button" class="mdl-button">Agree</button>
          <button type="button" class="mdl-button close">Disagree</button>
        </div> -->
      </dialog>

      <button id="scientist-but" type="button" class="mdl-button">Meet the Scientist</button>
      <dialog class="mdl-dialog" id="scientist-dia">
        <h2 class="mdl-dialog__title" >Meet the Scientist</h2>
        <!-- <div class="mdl-dialog__content">
          <p>
            Allowing us to collect data will let us get you the information you want faster.
          </p>
        </div>
        <div class="mdl-dialog__actions">
          <button type="button" class="mdl-button">Agree</button>
          <button type="button" class="mdl-button close">Disagree</button>
        </div> -->
      </dialog>



  </footer>

  <script>
    var history_dia = document.querySelector('#history-dia');
    var science_dia = document.querySelector('#science-dia');
    var scientist_dia = document.querySelector('#scientist-dia');

    var history_but = document.querySelector('#history-but');
    var science_but = document.querySelector('#science-but');
    var scientist_but = document.querySelector('#scientist-but');

    if (! science_dia.showModal) {
      dialogPolyfill.registerDialog(science_dia);
    }
    science_but.addEventListener('click', function() {
      science_dia.showModal();
    });
    science_dia.querySelector('.close').addEventListener('click', function() {
      science_dia.close();
    });

    if (! history_dia.showModal) {
      dialogPolyfill.registerDialog(history_dia);
    }
    history_but.addEventListener('click', function() {
      history_dia.showModal();
    });
    history_dia.querySelector('.close').addEventListener('click', function() {
      history_dia.close();
    });



    if (! scientist_dia.showModal) {
      dialogPolyfill.registerDialog(scientist_dia);
    }
    scientist_but.addEventListener('click', function() {
      scientist_dia.showModal();
    });
    scientist_dia.querySelector('.close').addEventListener('click', function() {
      scientist_dia.close();
    });
  </script>



  <script src="https://hammerjs.github.io/dist/hammer.js"></script>
  <script>

    var top_ctl = document.querySelector(".top-ctl");
    var bottom_ctl = document.querySelector(".bottom-ctl");
    var input = document.querySelector("#number1");
    var input2 = document.querySelector("#number2");
    var input3 = document.getElementById("metal1");
    var input4 = document.getElementById("metal2");
    var input5 = document.querySelector("#medium1");
    var input6 = document.querySelector("#medium2");
    // var svg = document.querySelector("#mysvg")

    var cylinder = document.querySelector("#cylinder");
    var r = 0;
    var g = 0;
    var b = 0;
    var l_index = 0;
    var r_index = 0;
    var metal = "Au";
    var medium = "glass";
    var svg = null;

    // get the exteranl svg file and parse it into DOM
    const loadSVG = async () => {
      const response = await fetch('rec.svg');
      const text = await response.text();
      // console.log(text, 'texttexttext');
      document.querySelector(".content").insertAdjacentHTML('afterBegin', text);
      svg = document.querySelector("#mysvg");

      // listen the selected item and store the color, value in class
      svg.addEventListener("click", function (evt) {
        //console.log(evt.target);
        const targetColor = evt.target.getAttribute("data-color");

        if (targetColor) {
          // console.log(evt.target.getAttribute("data-color"))
          Array.from(svg.querySelectorAll(".color-selector")).forEach(d => {
            // console.log(d);
            d.classList.remove("selected");
          })
          //set up the selected item's attribute at css
          evt.target.classList.add("selected");
          cylinder.setAttribute("color", targetColor);

          rgb_value = targetColor
            .substring(0, targetColor.length - 1)
            .substring(4)
            .split(",")
            .map(d => Number(d));
          //console.log(rgb_value)
          r = rgb_value[0];
          g = rgb_value[1];
          b = rgb_value[2];

          l_index = parseInt(evt.target.getAttribute("l_index"));
          r_index = parseInt(evt.target.getAttribute("r_index"));

          metal = evt.target.getAttribute("metal");
          //console.log(metal)
          medium = evt.target.getAttribute("medium");
          //console.log(medium)

          input.value = l_index;
          input2.value = r_index;

          if (metal === 'Au') {
            document.querySelector("#metal1").checked = true
          };
          if (medium === 'glass') {
            document.querySelector("#medium1").checked = true
          };
          // evt.target.setAttribute("data-color", newColor);
          // evt.target.style.fill = newColor;

        }
      });

      input.addEventListener("change", function (event) {
        //console.log(event);
        console.log(event.target.value);

        l_index = parseInt(event.target.value);
        // checking if the ratio of L/R >2
        var ratio_value = color_map[metal + "_" + medium].R[r_index][0];
        var length_value = color_map[metal + "_" + medium].R[0][l_index];
        var first_radius_value = color_map[metal + "_" + medium].R[1][0];
        if (length_value/ratio_value < 2){
          console.log("ratio of L/R < 2!!!")
          r_index =Math.floor((length_value/2 - first_radius_value)/2) + 1
          input2.value = r_index
        }

        r = color_map[metal + "_" + medium].R[r_index][l_index];
        g = color_map[metal + "_" + medium].G[r_index][l_index];
        b = color_map[metal + "_" + medium].B[r_index][l_index];
        //bottom_ctl.style.background = "rgb(" + r + "," + g + "," + b + ")";


        //get the selected item
        const selected_target = document.querySelectorAll(".color-selector.selected")[0];
        //console.log(selected_target);
        const newColor = "rgb(" + r + "," + g + "," + b + ")";
        //set color for 3D particle
        cylinder.setAttribute("color", newColor)
        //set color for svg
        selected_target.style.fill = newColor;
        //store the current color
        selected_target.setAttribute("data-color", newColor);
        //store the current length and radius index
        selected_target.setAttribute("l_index", l_index);
        selected_target.setAttribute("r_index", r_index);

      });

      input2.addEventListener("change", function (event) {
        //console.log(event);
        //console.log("input2,", event.target.value);

        r_index = parseInt(event.target.value);

        // checking if the ratio of L/R >2
        var ratio_value = color_map[metal + "_" + medium].R[r_index][0];
        var length_value = color_map[metal + "_" + medium].R[0][l_index];
        var first_length_value = color_map[metal + "_" + medium].R[0][1];
        if (length_value/ratio_value < 2){
          console.log("ratio of L/R < 2!!!")
          l_index = (ratio_value*2 - first_length_value)/2 + 1
          input.value = l_index
        }

        r = color_map[metal + "_" + medium].R[r_index][l_index];
        g = color_map[metal + "_" + medium].G[r_index][l_index];
        b = color_map[metal + "_" + medium].B[r_index][l_index];
        const selected_target = document.querySelectorAll(".color-selector.selected")[0];
        //console.log(selected_target);
        const newColor = "rgb(" + r + "," + g + "," + b + ")";
        //set color for 3D particle
        cylinder.setAttribute("color", newColor)
        //set color for svg
        selected_target.style.fill = newColor;
        //store the current color
        selected_target.setAttribute("data-color", newColor);
        //store the current length and radius index
        selected_target.setAttribute("l_index", l_index);
        selected_target.setAttribute("r_index", r_index);
      });

      input3.addEventListener("change", function (event) {
        var m_color;
        console.log(event);
        console.log("input3,", event.target.value);
        if (event.target.checked) {
          metal = event.target.value;
        }
        svg.querySelector(".selected").setAttribute("metal", metal)
        r = color_map[metal + "_" + medium].R[r_index][l_index];
        g = color_map[metal + "_" + medium].G[r_index][l_index];
        b = color_map[metal + "_" + medium].B[r_index][l_index];

        //get the selected item
        const selected_target = document.querySelectorAll(".color-selector.selected")[0];
        console.log(selected_target);
        const newColor = "rgb(" + r + "," + g + "," + b + ")";
        //set color for 3D particle
        cylinder.setAttribute("color", newColor)
        //set color for svg
        selected_target.style.fill = newColor;
        //store the current color
        selected_target.setAttribute("data-color", newColor);
      });

      input4.addEventListener("change", function (event) {
        var m_color;
        console.log(event);
        console.log("input4,", event.target.value);
        if (event.target.checked) {
          metal = event.target.value;
        }
        svg.querySelector(".selected").setAttribute("metal", metal)
        r = color_map[metal + "_" + medium].R[r_index][l_index];
        g = color_map[metal + "_" + medium].G[r_index][l_index];
        b = color_map[metal + "_" + medium].B[r_index][l_index];

        //get the selected item
        const selected_target = document.querySelectorAll(".color-selector.selected")[0];
        console.log(selected_target);
        const newColor = "rgb(" + r + "," + g + "," + b + ")";
        //set color for 3D particle
        cylinder.setAttribute("color", newColor)
        //set color for svg
        selected_target.style.fill = newColor;
        //store the current color
        selected_target.setAttribute("data-color", newColor);
      });

      input5.addEventListener("change", function (event) {
        var sol_color;
        console.log(event);
        console.log("input5", event.target.value);
        if (event.target.checked) {
          medium = event.target.value;
        }
        svg.querySelector(".selected").setAttribute("medium", medium)
        r = color_map[metal + "_" + medium].R[r_index][l_index];
        g = color_map[metal + "_" + medium].G[r_index][l_index];
        b = color_map[metal + "_" + medium].B[r_index][l_index];

        //get the selected item
        const selected_target = document.querySelectorAll(".color-selector.selected")[0];
        console.log(selected_target);
        const newColor = "rgb(" + r + "," + g + "," + b + ")";
        //set color for 3D particle
        cylinder.setAttribute("color", newColor)
        //set color for svg
        selected_target.style.fill = newColor;
        //store the current color
        selected_target.setAttribute("data-color", newColor);
      });

      input6.addEventListener("change", function (event) {
          var sol_color;
          console.log(event);
          console.log("input6", event.target.value);
          if (event.target.checked) {
            medium = event.target.value;
          }
          svg.querySelector(".selected").setAttribute("medium", medium)
          r = color_map[metal + "_" + medium].R[r_index][l_index];
          g = color_map[metal + "_" + medium].G[r_index][l_index];
          b = color_map[metal + "_" + medium].B[r_index][l_index];

          //get the selected item
          const selected_target = document.querySelectorAll(".color-selector.selected")[0];
          console.log(selected_target);
          const newColor = "rgb(" + r + "," + g + "," + b + ")";
          //set color for 3D particle
          cylinder.setAttribute("color", newColor)
          //set color for svg
          selected_target.style.fill = newColor;
          //store the current color
          selected_target.setAttribute("data-color", newColor);
        });
    }

    loadSVG();

    //////////////////////////////////////////////////////////
    // nano particle with touch screen
    //////////////////////////////////////////////////////////
    var mc = new Hammer(cylinder);


    mc.get('pinch').set({ enable: true });
    mc.on( "pinch", function( ev ) {
      console.log(ev.scale)
      cylinder.textContent = ev.type +" gesture detected.";
    });
  </script>
</body>

</html>
